<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼ å‹‡å·¥ä½œæ—¥ç¨‹è¡¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* å¯¼èˆªæ æ ·å¼ */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .navbar-menu {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .navbar-menu button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .navbar-menu button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .navbar-menu button.active {
            background: #3498db;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.4);
        }
        
        .object-selector {
            position: relative;
        }
        
        .object-selector select {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .object-selector select option {
            background-color: #2c3e50;
            color: white;
        }
        
        /* å†…å®¹åŒºåŸŸæ ·å¼ */
        .content {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            min-height: 500px;
        }
        
        /* å‘¨è§†å›¾æ ·å¼ */
        .week-view {
            display: flex;
            flex-direction: column;
        }
        
        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .week-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .week-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .week-nav button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .week-nav button:hover {
            background-color: #2980b9;
        }
        
        .add-record-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .add-record-btn:hover {
            background-color: #27ae60;
        }
        
        .week-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
        }
        
        .day-column {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            min-height: 400px;
            background-color: #f9f9f9;
            transition: transform 0.3s;
        }
        
        .day-column:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .day-header {
            text-align: center;
            padding-bottom: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
            transition: background-color 0.3s;
            border-radius: 6px;
            padding: 8px;
        }
        
        .day-header:hover {
            background-color: #e8f4fc;
        }
        
        .records-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .record-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px;
            border-radius: 6px;
            background-color: white;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .record-item input[type="checkbox"] {
            margin-top: 4px;
            transform: scale(1.2);
        }
        
        .record-item.checked {
            opacity: 0.7;
            background-color: #f0f0f0;
        }
        
        .record-item.checked .record-content {
            text-decoration: line-through;
            color: #888;
        }
        
        .object-tag {
            color: #3498db;
            cursor: pointer;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
            background-color: #e8f4fc;
            transition: background-color 0.3s;
        }
        
        .object-tag:hover {
            background-color: #d1ebf9;
        }
        
        .delete-record {
            position: absolute;
            right: 10px;
            top: 10px;
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        
        .delete-record:hover {
            opacity: 1;
        }
        
        /* æœˆè§†å›¾æ ·å¼ */
        .month-view {
            display: none;
        }
        
        .month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .month-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .month-nav {
            display: flex;
            gap: 10px;
        }
        
        .month-nav button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .month-nav button:hover {
            background-color: #2980b9;
        }
        
        .month-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        
        .calendar-header {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            background-color: #f0f0f0;
            border-radius: 6px;
        }
        
        .calendar-cell {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            min-height: 120px;
            cursor: pointer;
            background-color: white;
            transition: all 0.3s;
            position: relative;
        }
        
        .calendar-cell:hover {
            background-color: #f0f7ff;
            transform: scale(1.02);
        }
        
        .calendar-cell.today {
            background-color: #e8f4fc;
            border: 2px solid #3498db;
        }
        
        .calendar-cell.other-month {
            background-color: #f9f9f9;
            color: #aaa;
        }
        
        .cell-date {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .cell-records {
            font-size: 0.85rem;
            color: #666;
        }
        
        .record-count {
            display: inline-block;
            background-color: #3498db;
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s;
        }
        
        .close-btn:hover {
            color: #e74c3c;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .btn-cancel {
            background-color: #e0e0e0;
            color: #333;
        }
        
        .btn-cancel:hover {
            background-color: #d0d0d0;
        }
        
        .btn-save {
            background-color: #3498db;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #2980b9;
        }
        
        .btn-add-reminder {
            background-color: #f39c12;
            color: white;
            width: 100%;
            padding: 12px;
            margin-top: 10px;
        }
        
        .btn-add-reminder:hover {
            background-color: #e67e22;
        }
        
        .btn-manage-objects {
            background-color: #9b59b6;
            color: white;
            margin-left: 10px;
        }
        
        .btn-manage-objects:hover {
            background-color: #8e44ad;
        }
        
        /* æé†’è®¾ç½®æ ·å¼ */
        .reminder-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .reminder-option-group {
            margin-bottom: 15px;
        }
        
        .reminder-option-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .importance-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .importance-options label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: normal;
            cursor: pointer;
            padding: 8px 12px;
            background-color: #f5f5f5;
            border-radius: 6px;
            transition: background-color 0.3s;
        }
        
        .importance-options label:hover {
            background-color: #e9e9e9;
        }
        
        .importance-options input[type="radio"] {
            margin: 0;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
            
            .navbar-menu {
                width: 100%;
                justify-content: center;
            }
            
            .week-days, .month-calendar {
                grid-template-columns: 1fr;
            }
            
            .day-column, .calendar-cell {
                min-height: auto;
            }
            
            .reminder-options {
                grid-template-columns: 1fr;
            }
        }
        
        /* å…¶ä»–è§†å›¾æ ·å¼ */
        .day-records-view, .month-records-view, .year-records-view {
            display: none;
        }
        
        .records-container {
            margin-top: 20px;
        }
        
        .record-list-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s;
            position: relative;
        }
        
        .record-list-item:hover {
            background-color: #f9f9f9;
        }
        
        .record-date {
            font-weight: bold;
            min-width: 80px;
            color: #2c3e50;
        }
        
        .record-object {
            color: #3498db;
            font-weight: bold;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            background-color: #e8f4fc;
        }
        
        .record-object:hover {
            background-color: #d1ebf9;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        /* å¯¹è±¡ç®¡ç†æ ·å¼ */
        .object-management {
            margin-top: 20px;
        }
        
        .object-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .object-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background-color: #f0f0f0;
            border-radius: 6px;
        }
        
        .object-item button {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .add-object-form {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .add-object-form input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .add-object-form button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¯¼èˆªæ  -->
        <div class="navbar">
            <div class="navbar-title">å¼ å‹‡å·¥ä½œæ—¥ç¨‹è¡¨</div>
            <div class="navbar-menu">
                <button id="month-view-btn">æœˆè§†å›¾</button>
                <button id="week-view-btn" class="active">å‘¨è§†å›¾</button>
                <button id="day-record-btn">æ—¥è®°äº‹</button>
                <button id="month-record-btn">æœˆè®°äº‹</button>
                <button id="year-record-btn">å¹´è®°äº‹</button>
                <div class="object-selector">
                    <select id="object-select">
                        <option value="">å¯¹è±¡é€‰æ‹©</option>
                    </select>
                </div>
                <button class="btn-manage-objects" id="manage-objects-btn">ç®¡ç†å¯¹è±¡</button>
            </div>
        </div>
        
        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="content">
            <!-- å‘¨è§†å›¾ -->
            <div id="week-view" class="week-view">
                <div class="week-header">
                    <div class="week-title" id="week-title">2025å¹´10æœˆ1æ—¥ - 2025å¹´10æœˆ7æ—¥ (ç¬¬40å‘¨)</div>
                    <div class="week-nav">
                        <button id="prev-week">â† ä¸Šå‘¨</button>
                        <button id="next-week">ä¸‹å‘¨ â†’</button>
                        <button class="add-record-btn" id="add-record-week">æ·»åŠ è®°äº‹</button>
                    </div>
                </div>
                <div class="week-days" id="week-days">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æœˆè§†å›¾ -->
            <div id="month-view" class="month-view">
                <div class="month-header">
                    <div class="month-title" id="month-title">2025å¹´10æœˆ</div>
                    <div class="month-nav">
                        <button id="prev-month">â† ä¸Šæœˆ</button>
                        <button id="next-month">ä¸‹æœˆ â†’</button>
                    </div>
                </div>
                <div class="month-calendar" id="month-calendar">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æ—¥è®°äº‹è§†å›¾ -->
            <div id="day-records-view" class="day-records-view">
                <div class="week-header">
                    <div class="week-title" id="day-title">2025å¹´10æœˆ3æ—¥ æ˜ŸæœŸäº”</div>
                    <div class="week-nav">
                        <button id="prev-day">â† å‰ä¸€å¤©</button>
                        <button id="next-day">åä¸€å¤© â†’</button>
                        <button class="add-record-btn" id="add-record-day">æ·»åŠ è®°äº‹</button>
                    </div>
                </div>
                <div class="records-container" id="day-records-container">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æœˆè®°äº‹è§†å›¾ -->
            <div id="month-records-view" class="month-records-view">
                <div class="month-header">
                    <div class="month-title" id="month-records-title">2025å¹´10æœˆè®°äº‹</div>
                    <div class="month-nav">
                        <button id="prev-month-record">â† ä¸Šæœˆ</button>
                        <button id="next-month-record">ä¸‹æœˆ â†’</button>
                    </div>
                </div>
                <div class="records-container" id="month-records-container">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- å¹´è®°äº‹è§†å›¾ -->
            <div id="year-records-view" class="year-records-view">
                <div class="month-header">
                    <div class="month-title" id="year-title">2025å¹´è®°äº‹</div>
                    <div class="month-nav">
                        <button id="prev-year">â† ä¸Šå¹´</button>
                        <button id="next-year">ä¸‹å¹´ â†’</button>
                    </div>
                </div>
                <div class="records-container" id="year-records-container">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ è®°äº‹æ¨¡æ€æ¡† -->
    <div id="add-record-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">æ·»åŠ è®°äº‹</div>
                <button class="close-btn">&times;</button>
            </div>
            <form id="add-record-form">
                <div class="form-group">
                    <label for="record-date">æ—¥æœŸ</label>
                    <input type="date" id="record-date" required>
                </div>
                <div class="form-group">
                    <label for="record-object">å¯¹è±¡é€‰æ‹©</label>
                    <select id="record-object" required>
                        <option value="">è¯·é€‰æ‹©å¯¹è±¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="record-content">è®°äº‹å†…å®¹</label>
                    <textarea id="record-content" placeholder="è¯·è¾“å…¥è®°äº‹å†…å®¹..." required></textarea>
                </div>
                <button type="button" class="btn btn-add-reminder" id="add-reminder-btn">æ·»åŠ æé†’</button>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" id="cancel-add-record">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-save">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- æé†’è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="reminder-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">è®¾ç½®æé†’</div>
                <button class="close-btn">&times;</button>
            </div>
            <form id="reminder-form">
                <div class="form-group">
                    <label>æé†’æ—¥æœŸ</label>
                    <input type="date" id="reminder-date" required>
                </div>
                
                <div class="reminder-options">
                    <div class="reminder-option-group">
                        <label>é‡è¦äº‹é¡¹</label>
                        <div class="importance-options">
                            <label><input type="radio" name="importance" value="none" checked> ä¸é‡è¦</label>
                            <label><input type="radio" name="importance" value="hourly"> æ¯å°æ—¶æé†’</label>
                            <label><input type="radio" name="importance" value="3hourly"> æ¯ä¸‰å°æ—¶æé†’</label>
                            <label><input type="radio" name="importance" value="6hourly"> æ¯å…­å°æ—¶æé†’</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" id="cancel-reminder">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-save">ç¡®å®š</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- å¯¹è±¡ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="object-management-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">å¯¹è±¡ç®¡ç†</div>
                <button class="close-btn">&times;</button>
            </div>
            <div class="object-management">
                <h3>æ·»åŠ æ–°å¯¹è±¡</h3>
                <div class="add-object-form">
                    <input type="text" id="new-object-name" placeholder="è¾“å…¥å¯¹è±¡åç§°...">
                    <button id="add-object-btn">æ·»åŠ </button>
                </div>
                
                <h3 style="margin-top: 20px;">ç°æœ‰å¯¹è±¡</h3>
                <div class="object-list" id="object-list">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ•°æ®
        let records = JSON.parse(localStorage.getItem('workRecords')) || [];
        let objects = JSON.parse(localStorage.getItem('workObjects')) || ['æ€»åŠ©', 'äººäº‹', 'è´¢åŠ¡', 'é”€å”®', 'æ¡è£…', 'å“è´¨æ‹‰å¤´', 'ç è£…', 'æŠ€æœ¯', 'ç»©æ•ˆè€ƒæ ¸', 'å…¬å¸è®°äº‹'];
        let currentView = 'week';
        let currentDate = new Date();
        let selectedObject = '';
        
        // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®ï¼ˆå¦‚æœæ²¡æœ‰æ•°æ®ï¼‰
        if (records.length === 0) {
            records = [
                {
                    id: 1,
                    date: '2025-10-01',
                    object: 'æ€»åŠ©',
                    content: 'å‡†å¤‡æœˆåº¦ä¼šè®®ææ–™',
                    completed: false,
                    createdAt: '2025-09-28T10:00:00'
                },
                {
                    id: 2,
                    date: '2025-10-01',
                    object: 'è´¢åŠ¡',
                    content: 'å®¡æ ¸ç¬¬ä¸‰å­£åº¦è´¢åŠ¡æŠ¥è¡¨',
                    completed: true,
                    createdAt: '2025-09-29T14:30:00'
                },
                {
                    id: 3,
                    date: '2025-10-02',
                    object: 'äººäº‹',
                    content: 'é¢è¯•æ–°å‘˜å·¥ - å‰ç«¯å¼€å‘å²—ä½',
                    completed: false,
                    createdAt: '2025-09-30T09:15:00'
                },
                {
                    id: 4,
                    date: '2025-10-03',
                    object: 'é”€å”®',
                    content: 'ä¸å®¢æˆ·æ´½è°ˆæ–°äº§å“åˆä½œ',
                    completed: false,
                    createdAt: '2025-10-01T16:45:00'
                },
                {
                    id: 5,
                    date: '2025-10-03',
                    object: 'æŠ€æœ¯',
                    content: 'ç³»ç»Ÿå‡çº§ä¸ç»´æŠ¤',
                    completed: false,
                    createdAt: '2025-10-02T11:20:00'
                },
                {
                    id: 6,
                    date: '2025-10-04',
                    object: 'ç»©æ•ˆè€ƒæ ¸',
                    content: 'å®Œæˆå‘˜å·¥å­£åº¦ç»©æ•ˆè¯„ä¼°',
                    completed: false,
                    createdAt: '2025-10-03T13:10:00'
                }
            ];
            localStorage.setItem('workRecords', JSON.stringify(records));
        }
        
        // ä¿å­˜å¯¹è±¡åˆ—è¡¨
        localStorage.setItem('workObjects', JSON.stringify(objects));
        
        // DOMå…ƒç´ 
        const weekView = document.getElementById('week-view');
        const monthView = document.getElementById('month-view');
        const dayRecordsView = document.getElementById('day-records-view');
        const monthRecordsView = document.getElementById('month-records-view');
        const yearRecordsView = document.getElementById('year-records-view');
        
        const addRecordModal = document.getElementById('add-record-modal');
        const reminderModal = document.getElementById('reminder-modal');
        const objectManagementModal = document.getElementById('object-management-modal');
        const addRecordForm = document.getElementById('add-record-form');
        const reminderForm = document.getElementById('reminder-form');
        
        const objectSelect = document.getElementById('object-select');
        const recordObjectSelect = document.getElementById('record-object');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            updateObjectSelects();
            renderWeekView();
        });
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // å¯¼èˆªæŒ‰é’®
            document.getElementById('month-view-btn').addEventListener('click', () => switchView('month'));
            document.getElementById('week-view-btn').addEventListener('click', () => switchView('week'));
            document.getElementById('day-record-btn').addEventListener('click', () => switchView('day'));
            document.getElementById('month-record-btn').addEventListener('click', () => switchView('month-record'));
            document.getElementById('year-record-btn').addEventListener('click', () => switchView('year-record'));
            
            // å¯¹è±¡ç®¡ç†æŒ‰é’®
            document.getElementById('manage-objects-btn').addEventListener('click', showObjectManagementModal);
            document.getElementById('add-object-btn').addEventListener('click', addNewObject);
            
            // å‘¨è§†å›¾å¯¼èˆª
            document.getElementById('prev-week').addEventListener('click', () => changeWeek(-1));
            document.getElementById('next-week').addEventListener('click', () => changeWeek(1));
            
            // æœˆè§†å›¾å¯¼èˆª
            document.getElementById('prev-month').addEventListener('click', () => changeMonth(-1));
            document.getElementById('next-month').addEventListener('click', () => changeMonth(1));
            
            // æ—¥è®°äº‹å¯¼èˆª
            document.getElementById('prev-day').addEventListener('click', () => changeDay(-1));
            document.getElementById('next-day').addEventListener('click', () => changeDay(1));
            
            // æœˆè®°äº‹å¯¼èˆª
            document.getElementById('prev-month-record').addEventListener('click', () => changeMonthRecord(-1));
            document.getElementById('next-month-record').addEventListener('click', () => changeMonthRecord(1));
            
            // å¹´è®°äº‹å¯¼èˆª
            document.getElementById('prev-year').addEventListener('click', () => changeYear(-1));
            document.getElementById('next-year').addEventListener('click', () => changeYear(1));
            
            // æ·»åŠ è®°äº‹æŒ‰é’®
            document.getElementById('add-record-week').addEventListener('click', showAddRecordModal);
            document.getElementById('add-record-day').addEventListener('click', showAddRecordModal);
            
            // å…³é—­æ¨¡æ€æ¡†
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });
            
            // å–æ¶ˆæŒ‰é’®
            document.getElementById('cancel-add-record').addEventListener('click', closeAllModals);
            document.getElementById('cancel-reminder').addEventListener('click', () => {
                reminderModal.style.display = 'none';
            });
            
            // æ·»åŠ æé†’æŒ‰é’®
            document.getElementById('add-reminder-btn').addEventListener('click', () => {
                // è®¾ç½®æé†’æ—¥æœŸä¸ºè®°äº‹æ—¥æœŸ
                const recordDate = document.getElementById('record-date').value;
                document.getElementById('reminder-date').value = recordDate;
                
                reminderModal.style.display = 'flex';
            });
            
            // è¡¨å•æäº¤
            addRecordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveRecord();
            });
            
            reminderForm.addEventListener('submit', function(e) {
                e.preventDefault();
                reminderModal.style.display = 'none';
                // è¿™é‡Œå¯ä»¥ä¿å­˜æé†’è®¾ç½®
                alert('æé†’è®¾ç½®å·²ä¿å­˜ï¼');
            });
            
            // å¯¹è±¡é€‰æ‹©
            objectSelect.addEventListener('change', function() {
                selectedObject = this.value;
                refreshCurrentView();
            });
        }
        
        // å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†
        function closeAllModals() {
            addRecordModal.style.display = 'none';
            reminderModal.style.display = 'none';
            objectManagementModal.style.display = 'none';
        }
        
        // æ›´æ–°å¯¹è±¡é€‰æ‹©ä¸‹æ‹‰èœå•
        function updateObjectSelects() {
            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            objectSelect.innerHTML = '<option value="">å¯¹è±¡é€‰æ‹©</option>';
            recordObjectSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å¯¹è±¡</option>';
            
            // æ·»åŠ å¯¹è±¡é€‰é¡¹
            objects.forEach(object => {
                const option1 = document.createElement('option');
                option1.value = object;
                option1.textContent = object;
                objectSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = object;
                option2.textContent = object;
                recordObjectSelect.appendChild(option2);
            });
        }
        
        // æ˜¾ç¤ºå¯¹è±¡ç®¡ç†æ¨¡æ€æ¡†
        function showObjectManagementModal() {
            renderObjectList();
            objectManagementModal.style.display = 'flex';
        }
        
        // æ¸²æŸ“å¯¹è±¡åˆ—è¡¨
        function renderObjectList() {
            const objectList = document.getElementById('object-list');
            objectList.innerHTML = '';
            
            objects.forEach(object => {
                const objectItem = document.createElement('div');
                objectItem.className = 'object-item';
                objectItem.innerHTML = `
                    <span>${object}</span>
                    <button class="delete-object" data-object="${object}">Ã—</button>
                `;
                objectList.appendChild(objectItem);
            });
            
            // æ·»åŠ åˆ é™¤å¯¹è±¡äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-object').forEach(btn => {
                btn.addEventListener('click', function() {
                    const objectToDelete = this.getAttribute('data-object');
                    deleteObject(objectToDelete);
                });
            });
        }
        
        // æ·»åŠ æ–°å¯¹è±¡
        function addNewObject() {
            const newObjectInput = document.getElementById('new-object-name');
            const newObjectName = newObjectInput.value.trim();
            
            if (newObjectName && !objects.includes(newObjectName)) {
                objects.push(newObjectName);
                localStorage.setItem('workObjects', JSON.stringify(objects));
                updateObjectSelects();
                newObjectInput.value = '';
                renderObjectList();
                alert(`å¯¹è±¡"${newObjectName}"å·²æ·»åŠ ï¼`);
            } else if (objects.includes(newObjectName)) {
                alert('è¯¥å¯¹è±¡å·²å­˜åœ¨ï¼');
            } else {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¯¹è±¡åç§°ï¼');
            }
        }
        
        // åˆ é™¤å¯¹è±¡
        function deleteObject(objectName) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤å¯¹è±¡"${objectName}"å—ï¼Ÿæ­¤æ“ä½œä¸ä¼šåˆ é™¤å·²æœ‰çš„è®°äº‹å†…å®¹ã€‚`)) {
                objects = objects.filter(obj => obj !== objectName);
                localStorage.setItem('workObjects', JSON.stringify(objects));
                updateObjectSelects();
                renderObjectList();
                
                // å¦‚æœå½“å‰é€‰æ‹©äº†è¢«åˆ é™¤çš„å¯¹è±¡ï¼Œæ¸…ç©ºé€‰æ‹©
                if (selectedObject === objectName) {
                    selectedObject = '';
                    objectSelect.value = '';
                }
                
                refreshCurrentView();
            }
        }
        
        // åˆ‡æ¢è§†å›¾
        function switchView(view) {
            currentView = view;
            
            // éšè—æ‰€æœ‰è§†å›¾
            weekView.style.display = 'none';
            monthView.style.display = 'none';
            dayRecordsView.style.display = 'none';
            monthRecordsView.style.display = 'none';
            yearRecordsView.style.display = 'none';
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.navbar-menu button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºå½“å‰è§†å›¾
            if (view === 'month') {
                document.getElementById('month-view-btn').classList.add('active');
                monthView.style.display = 'block';
                renderMonthView();
            } else if (view === 'week') {
                document.getElementById('week-view-btn').classList.add('active');
                weekView.style.display = 'flex';
                renderWeekView();
            } else if (view === 'day') {
                document.getElementById('day-record-btn').classList.add('active');
                dayRecordsView.style.display = 'block';
                renderDayRecordsView();
            } else if (view === 'month-record') {
                document.getElementById('month-record-btn').classList.add('active');
                monthRecordsView.style.display = 'block';
                renderMonthRecordsView();
            } else if (view === 'year-record') {
                document.getElementById('year-record-btn').classList.add('active');
                yearRecordsView.style.display = 'block';
                renderYearRecordsView();
            }
        }
        
        // åˆ·æ–°å½“å‰è§†å›¾
        function refreshCurrentView() {
            switchView(currentView);
        }
        
        // æ¸²æŸ“å‘¨è§†å›¾
        function renderWeekView() {
            const weekDaysContainer = document.getElementById('week-days');
            weekDaysContainer.innerHTML = '';
            
            // è·å–å½“å‰å‘¨çš„æ—¥æœŸèŒƒå›´
            const weekDates = getWeekDates(currentDate);
            
            // æ›´æ–°å‘¨æ ‡é¢˜
            const startDate = formatDate(weekDates[0], 'YYYYå¹´MMæœˆDDæ—¥');
            const endDate = formatDate(weekDates[6], 'YYYYå¹´MMæœˆDDæ—¥');
            const weekNumber = getWeekNumber(weekDates[0]);
            document.getElementById('week-title').textContent = `${startDate} - ${endDate} (ç¬¬${weekNumber}å‘¨)`;
            
            // ç”Ÿæˆä¸€å‘¨çš„æ—¥æœŸåˆ—
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            
            weekDates.forEach((date, index) => {
                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column';
                
                const dateStr = formatDate(date, 'YYYY-MM-DD');
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.innerHTML = `${weekdays[index]}<br>${formatDate(date, 'MMæœˆDDæ—¥')}`;
                dayHeader.addEventListener('click', () => {
                    currentDate = new Date(date);
                    switchView('day');
                });
                
                const recordsList = document.createElement('div');
                recordsList.className = 'records-list';
                
                // è·å–å½“å¤©çš„è®°å½•
                const dayRecords = getRecordsByDate(dateStr);
                
                if (dayRecords.length > 0) {
                    dayRecords.forEach(record => {
                        if (selectedObject && record.object !== selectedObject) return;
                        
                        const recordItem = document.createElement('div');
                        recordItem.className = `record-item ${record.completed ? 'checked' : ''}`;
                        recordItem.innerHTML = `
                            <input type="checkbox" ${record.completed ? 'checked' : ''} data-id="${record.id}">
                            <span class="object-tag" data-object="${record.object}">${record.object}</span>
                            <span class="record-content">${record.content}</span>
                            <button class="delete-record" data-id="${record.id}">Ã—</button>
                        `;
                        recordsList.appendChild(recordItem);
                    });
                } else {
                    recordsList.innerHTML = '<div class="empty-state">æš‚æ— è®°äº‹</div>';
                }
                
                dayColumn.appendChild(dayHeader);
                dayColumn.appendChild(recordsList);
                weekDaysContainer.appendChild(dayColumn);
            });
            
            // æ·»åŠ å¤é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.record-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    toggleRecordCompletion(recordId, this.checked);
                });
            });
            
            // æ·»åŠ å¯¹è±¡æ ‡ç­¾äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.object-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const object = this.getAttribute('data-object');
                    objectSelect.value = object;
                    selectedObject = object;
                    refreshCurrentView();
                });
            });
            
            // æ·»åŠ åˆ é™¤è®°å½•äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-record').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    deleteRecord(recordId);
                });
            });
        }
        
        // æ¸²æŸ“æœˆè§†å›¾
        function renderMonthView() {
            const monthCalendar = document.getElementById('month-calendar');
            monthCalendar.innerHTML = '';
            
            // æ›´æ–°æœˆæ ‡é¢˜
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            document.getElementById('month-title').textContent = `${year}å¹´${month}æœˆ`;
            
            // ç”Ÿæˆæ—¥å†è¡¨å¤´
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            weekdays.forEach(day => {
                const headerCell = document.createElement('div');
                headerCell.className = 'calendar-header';
                headerCell.textContent = day;
                monthCalendar.appendChild(headerCell);
            });
            
            // è·å–å½“æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            
            // è·å–å½“æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ ï¼ˆ0-6ï¼Œ0æ˜¯å‘¨æ—¥ï¼‰
            const firstDayWeekday = firstDay.getDay();
            
            // è·å–ä¸Šä¸ªæœˆçš„æœ€åå‡ å¤©
            const prevMonthLastDay = new Date(year, month - 1, 0).getDate();
            
            // ç”Ÿæˆæ—¥å†æ ¼å­
            for (let i = 0; i < 42; i++) {
                const cell = document.createElement('div');
                
                if (i < firstDayWeekday) {
                    // ä¸Šä¸ªæœˆçš„æ—¥æœŸ
                    const date = prevMonthLastDay - firstDayWeekday + i + 1;
                    cell.className = 'calendar-cell other-month';
                    cell.innerHTML = `<div class="cell-date">${date}</div>`;
                } else if (i - firstDayWeekday + 1 > lastDay.getDate()) {
                    // ä¸‹ä¸ªæœˆçš„æ—¥æœŸ
                    const date = i - firstDayWeekday - lastDay.getDate() + 1;
                    cell.className = 'calendar-cell other-month';
                    cell.innerHTML = `<div class="cell-date">${date}</div>`;
                } else {
                    // å½“æœˆçš„æ—¥æœŸ
                    const date = i - firstDayWeekday + 1;
                    const dateStr = `${year}-${month.toString().padStart(2, '0')}-${date.toString().padStart(2, '0')}`;
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
                    const today = new Date();
                    const isToday = today.getFullYear() === year && 
                                   today.getMonth() === month - 1 && 
                                   today.getDate() === date;
                    
                    cell.className = `calendar-cell ${isToday ? 'today' : ''}`;
                    
                    // è·å–å½“å¤©çš„è®°å½•
                    const dayRecords = getRecordsByDate(dateStr);
                    const completedCount = dayRecords.filter(r => r.completed).length;
                    
                    cell.innerHTML = `
                        <div class="cell-date">${date}</div>
                        <div class="cell-records">
                            ${dayRecords.length > 0 ? `è®°äº‹: ${dayRecords.length} (å®Œæˆ: ${completedCount})` : 'æš‚æ— è®°äº‹'}
                        </div>
                        ${dayRecords.length > 0 ? `<div class="record-count">${dayRecords.length}</div>` : ''}
                    `;
                    
                    cell.addEventListener('click', () => {
                        currentDate = new Date(dateStr);
                        switchView('day');
                    });
                }
                
                monthCalendar.appendChild(cell);
            }
        }
        
        // æ¸²æŸ“æ—¥è®°äº‹è§†å›¾
        function renderDayRecordsView() {
            const dayRecordsContainer = document.getElementById('day-records-container');
            dayRecordsContainer.innerHTML = '';
            
            // æ›´æ–°æ—¥æœŸæ ‡é¢˜
            const dateStr = formatDate(currentDate, 'YYYYå¹´MMæœˆDDæ—¥');
            const weekday = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][currentDate.getDay()];
            document.getElementById('day-title').textContent = `${dateStr} æ˜ŸæœŸ${weekday}`;
            
            // è·å–å½“å¤©çš„è®°å½•
            const dateKey = formatDate(currentDate, 'YYYY-MM-DD');
            const dayRecords = getRecordsByDate(dateKey);
            
            if (dayRecords.length > 0) {
                dayRecords.forEach(record => {
                    if (selectedObject && record.object !== selectedObject) return;
                    
                    const recordItem = document.createElement('div');
                    recordItem.className = `record-list-item ${record.completed ? 'checked' : ''}`;
                    recordItem.innerHTML = `
                        <input type="checkbox" ${record.completed ? 'checked' : ''} data-id="${record.id}">
                        <div class="record-date">${formatDate(new Date(record.date), 'MMæœˆDDæ—¥')}</div>
                        <div class="record-object" data-object="${record.object}">${record.object}</div>
                        <div class="record-content">${record.content}</div>
                        <button class="delete-record" data-id="${record.id}">Ã—</button>
                    `;
                    dayRecordsContainer.appendChild(recordItem);
                });
            } else {
                dayRecordsContainer.innerHTML = `
                    <div class="empty-state">
                        <i>ğŸ“</i>
                        <div>ä»Šå¤©è¿˜æ²¡æœ‰è®°äº‹</div>
                        <p>ç‚¹å‡»"æ·»åŠ è®°äº‹"æŒ‰é’®åˆ›å»ºæ–°çš„è®°äº‹</p>
                    </div>
                `;
            }
            
            // æ·»åŠ å¤é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.record-list-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    toggleRecordCompletion(recordId, this.checked);
                });
            });
            
            // æ·»åŠ å¯¹è±¡æ ‡ç­¾äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.record-object').forEach(tag => {
                tag.addEventListener('click', function() {
                    const object = this.getAttribute('data-object');
                    objectSelect.value = object;
                    selectedObject = object;
                    refreshCurrentView();
                });
            });
            
            // æ·»åŠ åˆ é™¤è®°å½•äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-record').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    deleteRecord(recordId);
                });
            });
        }
        
        // æ¸²æŸ“æœˆè®°äº‹è§†å›¾
        function renderMonthRecordsView() {
            const monthRecordsContainer = document.getElementById('month-records-container');
            monthRecordsContainer.innerHTML = '';
            
            // æ›´æ–°æœˆæ ‡é¢˜
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            document.getElementById('month-records-title').textContent = `${year}å¹´${month}æœˆè®°äº‹`;
            
            // è·å–å½“æœˆçš„è®°å½•
            const monthRecords = getRecordsByMonth(year, month);
            
            if (monthRecords.length > 0) {
                // æŒ‰å¯¹è±¡åˆ†ç»„
                const groupedRecords = groupRecordsByObject(monthRecords);
                
                Object.keys(groupedRecords).forEach(object => {
                    if (selectedObject && object !== selectedObject) return;
                    
                    const objectSection = document.createElement('div');
                    objectSection.className = 'object-section';
                    objectSection.innerHTML = `<h3>${object}</h3>`;
                    
                    const recordsList = document.createElement('div');
                    
                    groupedRecords[object].forEach(record => {
                        const recordItem = document.createElement('div');
                        recordItem.className = `record-list-item ${record.completed ? 'checked' : ''}`;
                        
                        // æ ¼å¼åŒ–æ—¥æœŸå’Œåºå·
                        const recordDate = new Date(record.date);
                        const day = recordDate.getDate().toString().padStart(2, '0');
                        const contentWithNumber = `${day}${record.content}`;
                        
                        recordItem.innerHTML = `
                            <input type="checkbox" ${record.completed ? 'checked' : ''} data-id="${record.id}">
                            <div class="record-date">${formatDate(recordDate, 'MMæœˆDDæ—¥')}</div>
                            <div class="record-content">${contentWithNumber}</div>
                            <button class="delete-record" data-id="${record.id}">Ã—</button>
                        `;
                        recordsList.appendChild(recordItem);
                    });
                    
                    objectSection.appendChild(recordsList);
                    monthRecordsContainer.appendChild(objectSection);
                });
            } else {
                monthRecordsContainer.innerHTML = `
                    <div class="empty-state">
                        <i>ğŸ“…</i>
                        <div>æœ¬æœˆè¿˜æ²¡æœ‰è®°äº‹</div>
                        <p>ç‚¹å‡»"æ·»åŠ è®°äº‹"æŒ‰é’®åˆ›å»ºæ–°çš„è®°äº‹</p>
                    </div>
                `;
            }
            
            // æ·»åŠ å¤é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.record-list-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    toggleRecordCompletion(recordId, this.checked);
                });
            });
            
            // æ·»åŠ åˆ é™¤è®°å½•äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-record').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    deleteRecord(recordId);
                });
            });
        }
        
        // æ¸²æŸ“å¹´è®°äº‹è§†å›¾
        function renderYearRecordsView() {
            const yearRecordsContainer = document.getElementById('year-records-container');
            yearRecordsContainer.innerHTML = '';
            
            // æ›´æ–°å¹´æ ‡é¢˜
            const year = currentDate.getFullYear();
            document.getElementById('year-title').textContent = `${year}å¹´è®°äº‹`;
            
            // è·å–å½“å¹´çš„è®°å½•
            const yearRecords = getRecordsByYear(year);
            
            if (yearRecords.length > 0) {
                // æŒ‰å¯¹è±¡åˆ†ç»„
                const groupedRecords = groupRecordsByObject(yearRecords);
                
                Object.keys(groupedRecords).forEach(object => {
                    if (selectedObject && object !== selectedObject) return;
                    
                    const objectSection = document.createElement('div');
                    objectSection.className = 'object-section';
                    objectSection.innerHTML = `<h3>${object}</h3>`;
                    
                    const recordsList = document.createElement('div');
                    
                    groupedRecords[object].forEach(record => {
                        const recordItem = document.createElement('div');
                        recordItem.className = `record-list-item ${record.completed ? 'checked' : ''}`;
                        
                        // æ ¼å¼åŒ–æ—¥æœŸå’Œåºå·
                        const recordDate = new Date(record.date);
                        const month = (recordDate.getMonth() + 1).toString().padStart(2, '0');
                        const day = recordDate.getDate().toString().padStart(2, '0');
                        const contentWithNumber = `${month}æœˆ${day}æ—¥ ${record.content}`;
                        
                        recordItem.innerHTML = `
                            <input type="checkbox" ${record.completed ? 'checked' : ''} data-id="${record.id}">
                            <div class="record-date">${formatDate(recordDate, 'MMæœˆDDæ—¥')}</div>
                            <div class="record-content">${contentWithNumber}</div>
                            <button class="delete-record" data-id="${record.id}">Ã—</button>
                        `;
                        recordsList.appendChild(recordItem);
                    });
                    
                    objectSection.appendChild(recordsList);
                    yearRecordsContainer.appendChild(objectSection);
                });
            } else {
                yearRecordsContainer.innerHTML = `
                    <div class="empty-state">
                        <i>ğŸ“Š</i>
                        <div>ä»Šå¹´è¿˜æ²¡æœ‰è®°äº‹</div>
                        <p>ç‚¹å‡»"æ·»åŠ è®°äº‹"æŒ‰é’®åˆ›å»ºæ–°çš„è®°äº‹</p>
                    </div>
                `;
            }
            
            // æ·»åŠ å¤é€‰æ¡†äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.record-list-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    toggleRecordCompletion(recordId, this.checked);
                });
            });
            
            // æ·»åŠ åˆ é™¤è®°å½•äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-record').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    deleteRecord(recordId);
                });
            });
        }
        
        // æ˜¾ç¤ºæ·»åŠ è®°äº‹æ¨¡æ€æ¡†
        function showAddRecordModal() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºå½“å‰è§†å›¾çš„æ—¥æœŸ
            let defaultDate;
            if (currentView === 'day') {
                defaultDate = formatDate(currentDate, 'YYYY-MM-DD');
            } else {
                defaultDate = formatDate(new Date(), 'YYYY-MM-DD');
            }
            
            document.getElementById('record-date').value = defaultDate;
            document.getElementById('record-object').value = selectedObject || '';
            document.getElementById('record-content').value = '';
            
            addRecordModal.style.display = 'flex';
        }
        
        // ä¿å­˜è®°å½•
        function saveRecord() {
            const date = document.getElementById('record-date').value;
            const object = document.getElementById('record-object').value;
            const content = document.getElementById('record-content').value;
            
            // åˆ›å»ºæ–°è®°å½•
            const newRecord = {
                id: Date.now(),
                date: date,
                object: object,
                content: content,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            // æ·»åŠ åˆ°è®°å½•æ•°ç»„
            records.push(newRecord);
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('workRecords', JSON.stringify(records));
            
            // å…³é—­æ¨¡æ€æ¡†
            addRecordModal.style.display = 'none';
            
            // é‡ç½®è¡¨å•
            addRecordForm.reset();
            
            // åˆ·æ–°å½“å‰è§†å›¾
            refreshCurrentView();
            
            alert('è®°äº‹å·²ä¿å­˜ï¼');
        }
        
        // åˆ é™¤è®°å½•
        function deleteRecord(recordId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°äº‹å—ï¼Ÿ')) {
                records = records.filter(record => record.id !== recordId);
                localStorage.setItem('workRecords', JSON.stringify(records));
                refreshCurrentView();
            }
        }
        
        // åˆ‡æ¢è®°å½•å®ŒæˆçŠ¶æ€
        function toggleRecordCompletion(recordId, completed) {
            const recordIndex = records.findIndex(r => r.id === recordId);
            if (recordIndex !== -1) {
                records[recordIndex].completed = completed;
                localStorage.setItem('workRecords', JSON.stringify(records));
                refreshCurrentView();
            }
        }
        
        // å·¥å…·å‡½æ•°ï¼šè·å–ä¸€å‘¨çš„æ—¥æœŸ
        function getWeekDates(date) {
            const day = date.getDay();
            const startDate = new Date(date);
            startDate.setDate(date.getDate() - day);
            
            const weekDates = [];
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                weekDates.push(currentDate);
            }
            
            return weekDates;
        }
        
        // å·¥å…·å‡½æ•°ï¼šè·å–å‘¨æ•°
        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date, format) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            
            if (format === 'YYYY-MM-DD') {
                return `${year}-${month}-${day}`;
            } else if (format === 'YYYYå¹´MMæœˆDDæ—¥') {
                return `${year}å¹´${month}æœˆ${day}æ—¥`;
            } else if (format === 'MMæœˆDDæ—¥') {
                return `${month}æœˆ${day}æ—¥`;
            }
            
            return `${year}-${month}-${day}`;
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ ¹æ®æ—¥æœŸè·å–è®°å½•
        function getRecordsByDate(date) {
            return records.filter(record => record.date === date);
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ ¹æ®å¹´æœˆè·å–è®°å½•
        function getRecordsByMonth(year, month) {
            const monthStr = month.toString().padStart(2, '0');
            return records.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate.getFullYear() === year && 
                       (recordDate.getMonth() + 1) === month;
            });
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ ¹æ®å¹´è·å–è®°å½•
        function getRecordsByYear(year) {
            return records.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate.getFullYear() === year;
            });
        }
        
        // å·¥å…·å‡½æ•°ï¼šæŒ‰å¯¹è±¡åˆ†ç»„è®°å½•
        function groupRecordsByObject(records) {
            return records.reduce((groups, record) => {
                if (!groups[record.object]) {
                    groups[record.object] = [];
                }
                groups[record.object].push(record);
                return groups;
            }, {});
        }
        
        // å‘¨è§†å›¾å¯¼èˆª
        function changeWeek(offset) {
            currentDate.setDate(currentDate.getDate() + offset * 7);
            renderWeekView();
        }
        
        // æœˆè§†å›¾å¯¼èˆª
        function changeMonth(offset) {
            currentDate.setMonth(currentDate.getMonth() + offset);
            renderMonthView();
        }
        
        // æ—¥è®°äº‹å¯¼èˆª
        function changeDay(offset) {
            currentDate.setDate(currentDate.getDate() + offset);
            renderDayRecordsView();
        }
        
        // æœˆè®°äº‹å¯¼èˆª
        function changeMonthRecord(offset) {
            currentDate.setMonth(currentDate.getMonth() + offset);
            renderMonthRecordsView();
        }
        
        // å¹´è®°äº‹å¯¼èˆª
        function changeYear(offset) {
            currentDate.setFullYear(currentDate.getFullYear() + offset);
            renderYearRecordsView();
        }
    </script>
</body>
</html>