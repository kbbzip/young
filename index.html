<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>张勇工作日程表</title>
    
    <!-- 引入 Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }
        
        /* 导航栏样式 */
        .navbar {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-title {
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
        }
        
        .navbar-menu {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .navbar-menu button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.3s;
            font-size: 0.9rem;
            flex: 1;
            min-width: 80px;
            text-align: center;
        }
        
        .navbar-menu button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .navbar-menu button.active {
            background: #3498db;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.4);
        }
        
        .object-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .object-selector select {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            min-width: 120px;
        }
        
        .object-selector select option {
            background-color: #2c3e50;
            color: white;
        }
        
        .btn-manage-objects {
            background-color: #9b59b6;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        /* 内容区域样式 */
        .content {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            min-height: 400px;
        }
        
        /* 周视图样式 */
        .week-view {
            display: flex;
            flex-direction: column;
        }
        
        .week-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .week-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
        }
        
        .week-nav {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .week-nav button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .week-nav button:hover {
            background-color: #2980b9;
        }
        
        .add-record-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .add-record-btn:hover {
            background-color: #27ae60;
        }
        
        .week-days {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .week-days {
                grid-template-columns: repeat(7, 1fr);
            }
            
            .navbar {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .navbar-title {
                text-align: left;
                font-size: 1.5rem;
            }
            
            .navbar-menu {
                justify-content: flex-end;
            }
            
            .navbar-menu button {
                flex: none;
            }
            
            .week-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .week-title {
                text-align: left;
                font-size: 1.3rem;
            }
        }
        
        .day-column {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            background-color: #f9f9f9;
            transition: transform 0.3s;
            min-height: 200px;
        }
        
        .day-column:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .day-header {
            text-align: center;
            padding-bottom: 8px;
            margin-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
            transition: background-color 0.3s;
            border-radius: 6px;
            padding: 8px;
            font-size: 0.9rem;
        }
        
        .day-header:hover {
            background-color: #e8f4fc;
        }
        
        .records-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .record-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px;
            border-radius: 6px;
            background-color: white;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
            font-size: 0.85rem;
        }
        
        .record-item input[type="checkbox"] {
            margin-top: 3px;
            transform: scale(1.1);
        }
        
        .record-item.checked {
            opacity: 0.7;
            background-color: #f0f0f0;
        }
        
        .record-item.checked .record-content {
            text-decoration: line-through;
            color: #888;
        }
        
        .object-tag {
            color: #3498db;
            cursor: pointer;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
            background-color: #e8f4fc;
            transition: background-color 0.3s;
            font-size: 0.8rem;
        }
        
        .object-tag:hover {
            background-color: #d1ebf9;
        }
        
        .delete-record {
            position: absolute;
            right: 8px;
            top: 8px;
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        
        .delete-record:hover {
            opacity: 1;
        }
        
        /* 月视图样式 */
        .month-view {
            display: none;
        }
        
        .month-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        @media (min-width: 768px) {
            .month-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .month-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
        }
        
        .month-nav {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .month-nav button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .month-nav button:hover {
            background-color: #2980b9;
        }
        
        .month-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            font-size: 0.8rem;
        }
        
        .calendar-header {
            text-align: center;
            padding: 8px 5px;
            font-weight: bold;
            background-color: #f0f0f0;
            border-radius: 6px;
            font-size: 0.8rem;
        }
        
        .calendar-cell {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 8px 5px;
            min-height: 80px;
            cursor: pointer;
            background-color: white;
            transition: all 0.3s;
            position: relative;
            font-size: 0.75rem;
        }
        
        .calendar-cell:hover {
            background-color: #f0f7ff;
        }
        
        .calendar-cell.today {
            background-color: #e8f4fc;
            border: 2px solid #3498db;
        }
        
        .calendar-cell.other-month {
            background-color: #f9f9f9;
            color: #aaa;
        }
        
        .cell-date {
            font-weight: bold;
            margin-bottom: 3px;
            font-size: 0.9rem;
        }
        
        .cell-records {
            color: #666;
            font-size: 0.7rem;
        }
        
        .record-count {
            display: inline-block;
            background-color: #3498db;
            color: white;
            border-radius: 8px;
            padding: 1px 5px;
            font-size: 0.7rem;
            margin-top: 3px;
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s;
        }
        
        .close-btn:hover {
            color: #e74c3c;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9rem;
        }
        
        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .btn-cancel {
            background-color: #e0e0e0;
            color: #333;
        }
        
        .btn-cancel:hover {
            background-color: #d0d0d0;
        }
        
        .btn-save {
            background-color: #3498db;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #2980b9;
        }
        
        .btn-add-reminder {
            background-color: #f39c12;
            color: white;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
        }
        
        .btn-add-reminder:hover {
            background-color: #e67e22;
        }
        
        /* 提醒设置样式 */
        .reminder-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .reminder-option-group {
            margin-bottom: 15px;
        }
        
        .reminder-option-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .importance-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .importance-options label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: normal;
            cursor: pointer;
            padding: 6px 10px;
            background-color: #f5f5f5;
            border-radius: 6px;
            transition: background-color 0.3s;
            font-size: 0.85rem;
        }
        
        .importance-options label:hover {
            background-color: #e9e9e9;
        }
        
        .importance-options input[type="radio"] {
            margin: 0;
        }
        
        /* 其他视图样式 */
        .day-records-view, .month-records-view, .year-records-view {
            display: none;
        }
        
        .records-container {
            margin-top: 15px;
        }
        
        .record-list-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s;
            position: relative;
            font-size: 0.9rem;
        }
        
        .record-list-item:hover {
            background-color: #f9f9f9;
        }
        
        .record-date {
            font-weight: bold;
            min-width: 70px;
            color: #2c3e50;
            font-size: 0.8rem;
        }
        
        .record-object {
            color: #3498db;
            font-weight: bold;
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 4px;
            background-color: #e8f4fc;
            font-size: 0.8rem;
        }
        
        .record-object:hover {
            background-color: #d1ebf9;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #bdc3c7;
        }
        
        /* 对象管理样式 */
        .object-management {
            margin-top: 15px;
        }
        
        .object-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        
        .object-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background-color: #f0f0f0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .object-item button {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .add-object-form {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .add-object-form input {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .add-object-form button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        /* 加载状态 */
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        
        .sync-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: #2ecc71;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 导航栏 -->
        <div class="navbar">
            <div class="navbar-title">张勇工作日程表</div>
            <div class="navbar-menu">
                <button id="month-view-btn">月视图</button>
                <button id="week-view-btn" class="active">周视图</button>
                <button id="day-record-btn">日记事</button>
                <button id="month-record-btn">月记事</button>
                <button id="year-record-btn">年记事</button>
            </div>
            <div class="object-selector">
                <select id="object-select">
                    <option value="">对象选择</option>
                </select>
                <button class="btn-manage-objects" id="manage-objects-btn">管理对象</button>
            </div>
        </div>
        
        <!-- 内容区域 -->
        <div class="content">
            <!-- 加载状态 -->
            <div id="loading-state" class="loading">
                正在同步数据...
            </div>
            
            <!-- 周视图 -->
            <div id="week-view" class="week-view">
                <div class="week-header">
                    <div class="week-title" id="week-title">2025年10月1日 - 2025年10月7日 (第40周)</div>
                    <div class="week-nav">
                        <button id="prev-week">← 上周</button>
                        <button id="next-week">下周 →</button>
                        <button class="add-record-btn" id="add-record-week">添加记事</button>
                    </div>
                </div>
                <div class="week-days" id="week-days">
                    <!-- 动态生成 -->
                </div>
            </div>
            
            <!-- 月视图 -->
            <div id="month-view" class="month-view">
                <div class="month-header">
                    <div class="month-title" id="month-title">2025年10月</div>
                    <div class="month-nav">
                        <button id="prev-month">← 上月</button>
                        <button id="next-month">下月 →</button>
                    </div>
                </div>
                <div class="month-calendar" id="month-calendar">
                    <!-- 动态生成 -->
                </div>
            </div>
            
            <!-- 日记事视图 -->
            <div id="day-records-view" class="day-records-view">
                <div class="week-header">
                    <div class="week-title" id="day-title">2025年10月3日 星期五</div>
                    <div class="week-nav">
                        <button id="prev-day">← 前一天</button>
                        <button id="next-day">后一天 →</button>
                        <button class="add-record-btn" id="add-record-day">添加记事</button>
                    </div>
                </div>
                <div class="records-container" id="day-records-container">
                    <!-- 动态生成 -->
                </div>
            </div>
            
            <!-- 月记事视图 -->
            <div id="month-records-view" class="month-records-view">
                <div class="month-header">
                    <div class="month-title" id="month-records-title">2025年10月记事</div>
                    <div class="month-nav">
                        <button id="prev-month-record">← 上月</button>
                        <button id="next-month-record">下月 →</button>
                    </div>
                </div>
                <div class="records-container" id="month-records-container">
                    <!-- 动态生成 -->
                </div>
            </div>
            
            <!-- 年记事视图 -->
            <div id="year-records-view" class="year-records-view">
                <div class="month-header">
                    <div class="month-title" id="year-title">2025年记事</div>
                    <div class="month-nav">
                        <button id="prev-year">← 上年</button>
                        <button id="next-year">下年 →</button>
                    </div>
                </div>
                <div class="records-container" id="year-records-container">
                    <!-- 动态生成 -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加记事模态框 -->
    <div id="add-record-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">添加记事</div>
                <button class="close-btn">&times;</button>
            </div>
            <form id="add-record-form">
                <div class="form-group">
                    <label for="record-date">日期</label>
                    <input type="date" id="record-date" required>
                </div>
                <div class="form-group">
                    <label for="record-object">对象选择</label>
                    <select id="record-object" required>
                        <option value="">请选择对象</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="record-content">记事内容</label>
                    <textarea id="record-content" placeholder="请输入记事内容..." required></textarea>
                </div>
                <button type="button" class="btn btn-add-reminder" id="add-reminder-btn">添加提醒</button>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" id="cancel-add-record">取消</button>
                    <button type="submit" class="btn btn-save">保存</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 提醒设置模态框 -->
    <div id="reminder-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">设置提醒</div>
                <button class="close-btn">&times;</button>
            </div>
            <form id="reminder-form">
                <div class="form-group">
                    <label>提醒日期</label>
                    <input type="date" id="reminder-date" required>
                </div>
                
                <div class="reminder-options">
                    <div class="reminder-option-group">
                        <label>重要事项</label>
                        <div class="importance-options">
                            <label><input type="radio" name="importance" value="none" checked> 不重要</label>
                            <label><input type="radio" name="importance" value="hourly"> 每小时提醒</label>
                            <label><input type="radio" name="importance" value="3hourly"> 每三小时提醒</label>
                            <label><input type="radio" name="importance" value="6hourly"> 每六小时提醒</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" id="cancel-reminder">取消</button>
                    <button type="submit" class="btn btn-save">确定</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 对象管理模态框 -->
    <div id="object-management-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">对象管理</div>
                <button class="close-btn">&times;</button>
            </div>
            <div class="object-management">
                <h3>添加新对象</h3>
                <div class="add-object-form">
                    <input type="text" id="new-object-name" placeholder="输入对象名称...">
                    <button id="add-object-btn">添加</button>
                </div>
                
                <h3 style="margin-top: 20px;">现有对象</h3>
                <div class="object-list" id="object-list">
                    <!-- 动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase 配置 - 请替换为你的实际配置
        const firebaseConfig = {
           apiKey: "AIzaSyATuzgkJ0BNdpSEq7yhDXHKbaRnoDkzrnw",
    authDomain: "work-schedule-912e7.firebaseapp.com",
    projectId: "work-schedule-912e7",
    storageBucket: "work-schedule-912e7.firebasestorage.app",
    messagingSenderId: "721879897381",
    appId: "1:721879897381:web:61d8a609f94735ae63b6cc"
     };

        // 初始化 Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 初始化数据
        let records = [];
        let objects = ['总助', '人事', '财务', '销售', '条装', '品质拉头', '码装', '技术', '绩效考核', '公司记事'];
        let currentView = 'week';
        let currentDate = new Date();
        let selectedObject = '';
        let isOnline = true;

        // DOM元素
        const weekView = document.getElementById('week-view');
        const monthView = document.getElementById('month-view');
        const dayRecordsView = document.getElementById('day-records-view');
        const monthRecordsView = document.getElementById('month-records-view');
        const yearRecordsView = document.getElementById('year-records-view');
        const loadingState = document.getElementById('loading-state');

        const addRecordModal = document.getElementById('add-record-modal');
        const reminderModal = document.getElementById('reminder-modal');
        const objectManagementModal = document.getElementById('object-management-modal');
        const addRecordForm = document.getElementById('add-record-form');
        const reminderForm = document.getElementById('reminder-form');

        const objectSelect = document.getElementById('object-select');
        const recordObjectSelect = document.getElementById('record-object');

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            loadData();
        });

        // 从Firebase加载数据
        async function loadData() {
            try {
                loadingState.style.display = 'block';
                
                // 加载记录
                const recordsSnapshot = await db.collection('records').get();
                records = [];
                recordsSnapshot.forEach(doc => {
                    records.push({ id: doc.id, ...doc.data() });
                });
                
                // 加载对象
                const objectsSnapshot = await db.collection('objects').get();
                if (!objectsSnapshot.empty) {
                    objects = [];
                    objectsSnapshot.forEach(doc => {
                        objects.push(doc.data().name);
                    });
                }
                
                updateObjectSelects();
                renderWeekView();
                loadingState.style.display = 'none';
                showSyncStatus('数据同步成功');
            } catch (error) {
                console.error('加载数据失败:', error);
                loadingState.innerHTML = '数据加载失败，使用本地数据';
                setTimeout(() => {
                    loadingState.style.display = 'none';
                }, 2000);
            }
        }

        // 保存记录到Firebase
        async function saveRecordToFirebase(record) {
            try {
                if (record.id) {
                    await db.collection('records').doc(record.id.toString()).set({
                        date: record.date,
                        object: record.object,
                        content: record.content,
                        completed: record.completed,
                        createdAt: record.createdAt
                    });
                }
            } catch (error) {
                console.error('保存记录失败:', error);
            }
        }

        // 删除Firebase中的记录
        async function deleteRecordFromFirebase(recordId) {
            try {
                await db.collection('records').doc(recordId.toString()).delete();
            } catch (error) {
                console.error('删除记录失败:', error);
            }
        }

        // 保存对象到Firebase
        async function saveObjectsToFirebase() {
            try {
                // 清空现有对象
                const objectsSnapshot = await db.collection('objects').get();
                const deletePromises = [];
                objectsSnapshot.forEach(doc => {
                    deletePromises.push(db.collection('objects').doc(doc.id).delete());
                });
                await Promise.all(deletePromises);
                
                // 添加新对象
                const addPromises = objects.map((object, index) => {
                    return db.collection('objects').doc(index.toString()).set({
                        name: object
                    });
                });
                await Promise.all(addPromises);
            } catch (error) {
                console.error('保存对象失败:', error);
            }
        }

        // 显示同步状态
        function showSyncStatus(message) {
            const status = document.createElement('div');
            status.className = 'sync-status';
            status.textContent = message;
            document.body.appendChild(status);
            
            setTimeout(() => {
                status.remove();
            }, 3000);
        }

        // 初始化事件监听器
        function initEventListeners() {
            // 导航按钮
            document.getElementById('month-view-btn').addEventListener('click', () => switchView('month'));
            document.getElementById('week-view-btn').addEventListener('click', () => switchView('week'));
            document.getElementById('day-record-btn').addEventListener('click', () => switchView('day'));
            document.getElementById('month-record-btn').addEventListener('click', () => switchView('month-record'));
            document.getElementById('year-record-btn').addEventListener('click', () => switchView('year-record'));
            
            // 对象管理按钮
            document.getElementById('manage-objects-btn').addEventListener('click', showObjectManagementModal);
            document.getElementById('add-object-btn').addEventListener('click', addNewObject);
            
            // 周视图导航
            document.getElementById('prev-week').addEventListener('click', () => changeWeek(-1));
            document.getElementById('next-week').addEventListener('click', () => changeWeek(1));
            
            // 月视图导航
            document.getElementById('prev-month').addEventListener('click', () => changeMonth(-1));
            document.getElementById('next-month').addEventListener('click', () => changeMonth(1));
            
            // 日记事导航
            document.getElementById('prev-day').addEventListener('click', () => changeDay(-1));
            document.getElementById('next-day').addEventListener('click', () => changeDay(1));
            
            // 月记事导航
            document.getElementById('prev-month-record').addEventListener('click', () => changeMonthRecord(-1));
            document.getElementById('next-month-record').addEventListener('click', () => changeMonthRecord(1));
            
            // 年记事导航
            document.getElementById('prev-year').addEventListener('click', () => changeYear(-1));
            document.getElementById('next-year').addEventListener('click', () => changeYear(1));
            
            // 添加记事按钮
            document.getElementById('add-record-week').addEventListener('click', showAddRecordModal);
            document.getElementById('add-record-day').addEventListener('click', showAddRecordModal);
            
            // 关闭模态框
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });
            
            // 取消按钮
            document.getElementById('cancel-add-record').addEventListener('click', closeAllModals);
            document.getElementById('cancel-reminder').addEventListener('click', () => {
                reminderModal.style.display = 'none';
            });
            
            // 添加提醒按钮
            document.getElementById('add-reminder-btn').addEventListener('click', () => {
                const recordDate = document.getElementById('record-date').value;
                document.getElementById('reminder-date').value = recordDate;
                reminderModal.style.display = 'flex';
            });
            
            // 表单提交
            addRecordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveRecord();
            });
            
            reminderForm.addEventListener('submit', function(e) {
                e.preventDefault();
                reminderModal.style.display = 'none';
                alert('提醒设置已保存！');
            });
            
            // 对象选择
            objectSelect.addEventListener('change', function() {
                selectedObject = this.value;
                refreshCurrentView();
            });
        }

        // 关闭所有模态框
        function closeAllModals() {
            addRecordModal.style.display = 'none';
            reminderModal.style.display = 'none';
            objectManagementModal.style.display = 'none';
        }

        // 更新对象选择下拉菜单
        function updateObjectSelects() {
            objectSelect.innerHTML = '<option value="">对象选择</option>';
            recordObjectSelect.innerHTML = '<option value="">请选择对象</option>';
            
            objects.forEach(object => {
                const option1 = document.createElement('option');
                option1.value = object;
                option1.textContent = object;
                objectSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = object;
                option2.textContent = object;
                recordObjectSelect.appendChild(option2);
            });
        }

        // 显示对象管理模态框
        function showObjectManagementModal() {
            renderObjectList();
            objectManagementModal.style.display = 'flex';
        }

        // 渲染对象列表
        function renderObjectList() {
            const objectList = document.getElementById('object-list');
            objectList.innerHTML = '';
            
            objects.forEach(object => {
                const objectItem = document.createElement('div');
                objectItem.className = 'object-item';
                objectItem.innerHTML = `
                    <span>${object}</span>
                    <button class="delete-object" data-object="${object}">×</button>
                `;
                objectList.appendChild(objectItem);
            });
            
            document.querySelectorAll('.delete-object').forEach(btn => {
                btn.addEventListener('click', function() {
                    const objectToDelete = this.getAttribute('data-object');
                    deleteObject(objectToDelete);
                });
            });
        }

        // 添加新对象
        async function addNewObject() {
            const newObjectInput = document.getElementById('new-object-name');
            const newObjectName = newObjectInput.value.trim();
            
            if (newObjectName && !objects.includes(newObjectName)) {
                objects.push(newObjectName);
                await saveObjectsToFirebase();
                updateObjectSelects();
                newObjectInput.value = '';
                renderObjectList();
                alert(`对象"${newObjectName}"已添加！`);
            } else if (objects.includes(newObjectName)) {
                alert('该对象已存在！');
            } else {
                alert('请输入有效的对象名称！');
            }
        }

        // 删除对象
        async function deleteObject(objectName) {
            if (confirm(`确定要删除对象"${objectName}"吗？此操作不会删除已有的记事内容。`)) {
                objects = objects.filter(obj => obj !== objectName);
                await saveObjectsToFirebase();
                updateObjectSelects();
                renderObjectList();
                
                if (selectedObject === objectName) {
                    selectedObject = '';
                    objectSelect.value = '';
                }
                
                refreshCurrentView();
            }
        }

        // 切换视图
        function switchView(view) {
            currentView = view;
            
            weekView.style.display = 'none';
            monthView.style.display = 'none';
            dayRecordsView.style.display = 'none';
            monthRecordsView.style.display = 'none';
            yearRecordsView.style.display = 'none';
            
            document.querySelectorAll('.navbar-menu button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (view === 'month') {
                document.getElementById('month-view-btn').classList.add('active');
                monthView.style.display = 'block';
                renderMonthView();
            } else if (view === 'week') {
                document.getElementById('week-view-btn').classList.add('active');
                weekView.style.display = 'flex';
                renderWeekView();
            } else if (view === 'day') {
                document.getElementById('day-record-btn').classList.add('active');
                dayRecordsView.style.display = 'block';
                renderDayRecordsView();
            } else if (view === 'month-record') {
                document.getElementById('month-record-btn').classList.add('active');
                monthRecordsView.style.display = 'block';
                renderMonthRecordsView();
            } else if (view === 'year-record') {
                document.getElementById('year-record-btn').classList.add('active');
                yearRecordsView.style.display = 'block';
                renderYearRecordsView();
            }
        }

        // 刷新当前视图
        function refreshCurrentView() {
            switchView(currentView);
        }

        // 渲染周视图
        function renderWeekView() {
            const weekDaysContainer = document.getElementById('week-days');
            weekDaysContainer.innerHTML = '';
            
            const weekDates = getWeekDates(currentDate);
            
            const startDate = formatDate(weekDates[0], 'YYYY年MM月DD日');
            const endDate = formatDate(weekDates[6], 'YYYY年MM月DD日');
            const weekNumber = getWeekNumber(weekDates[0]);
            document.getElementById('week-title').textContent = `${startDate} - ${endDate} (第${weekNumber}周)`;
            
            const weekdays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
            
            weekDates.forEach((date, index) => {
                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column';
                
                const dateStr = formatDate(date, 'YYYY-MM-DD');
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.innerHTML = `${weekdays[index]}<br>${formatDate(date, 'MM月DD日')}`;
                dayHeader.addEventListener('click', () => {
                    currentDate = new Date(date);
                    switchView('day');
                });
                
                const recordsList = document.createElement('div');
                recordsList.className = 'records-list';
                
                const dayRecords = getRecordsByDate(dateStr);
                
                if (dayRecords.length > 0) {
                    dayRecords.forEach(record => {
                        if (selectedObject && record.object !== selectedObject) return;
                        
                        const recordItem = document.createElement('div');
                        recordItem.className = `record-item ${record.completed ? 'checked' : ''}`;
                        recordItem.innerHTML = `
                            <input type="checkbox" ${record.completed ? 'checked' : ''} data-id="${record.id}">
                            <span class="object-tag" data-object="${record.object}">${record.object}</span>
                            <span class="record-content">${record.content}</span>
                            <button class="delete-record" data-id="${record.id}">×</button>
                        `;
                        recordsList.appendChild(recordItem);
                    });
                } else {
                    recordsList.innerHTML = '<div class="empty-state">暂无记事</div>';
                }
                
                dayColumn.appendChild(dayHeader);
                dayColumn.appendChild(recordsList);
                weekDaysContainer.appendChild(dayColumn);
            });
            
            document.querySelectorAll('.record-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const recordId = this.getAttribute('data-id');
                    toggleRecordCompletion(recordId, this.checked);
                });
            });
            
            document.querySelectorAll('.object-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const object = this.getAttribute('data-object');
                    objectSelect.value = object;
                    selectedObject = object;
                    refreshCurrentView();
                });
            });
            
            document.querySelectorAll('.delete-record').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordId = this.getAttribute('data-id');
                    deleteRecord(recordId);
                });
            });
        }

        // 渲染月视图
        function renderMonthView() {
            const monthCalendar = document.getElementById('month-calendar');
            monthCalendar.innerHTML = '';
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            document.getElementById('month-title').textContent = `${year}年${month}月`;
            
            const weekdays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
            weekdays.forEach(day => {
                const headerCell = document.createElement('div');
                headerCell.className = 'calendar-header';
                headerCell.textContent = day;
                monthCalendar.appendChild(headerCell);
            });
            
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const firstDayWeekday = firstDay.getDay();
            const prevMonthLastDay = new Date(year, month - 1, 0).getDate();
            
            for (let i = 0; i < 42; i++) {
                const cell = document.createElement('div');
                
                if (i < firstDayWeekday) {
                    const date = prevMonthLastDay - firstDayWeekday + i + 1;
                    cell.className = 'calendar-cell other-month';
                    cell.innerHTML = `<div class="cell-date">${date}</div>`;
                } else if (i - firstDayWeekday + 1 > lastDay.getDate()) {
                    const date = i - firstDayWeekday - lastDay.getDate() + 1;
                    cell.className = 'calendar-cell other-month';
                    cell.innerHTML = `<div class="cell-date">${date}</div>`;
                } else {
                    const date = i - firstDayWeekday + 1;
                    const dateStr = `${year}-${month.toString().padStart(2, '0')}-${date.toString().padStart(2, '0')}`;
                    
                    const today = new Date();
                    const isToday = today.getFullYear() === year && 
                                   today.getMonth() === month - 1 && 
                                   today.getDate() === date;
                    
                    cell.className = `calendar-cell ${isToday ? 'today' : ''}`;
                    
                    const dayRecords = getRecordsByDate(dateStr);
                    const completedCount = dayRecords.filter(r => r.completed).length;
                    
                    cell.innerHTML = `
                        <div class="cell-date">${date}</div>
                        <div class="cell-records">
                            ${dayRecords.length > 0 ? `记事: ${dayRecords.length} (完成: ${completedCount})` : '暂无记事'}
                        </div>
                        ${dayRecords.length > 0 ? `<div class="record-count">${dayRecords.length}</div>` : ''}
                    `;
                    
                    cell.addEventListener('click', () => {
                        currentDate = new Date(dateStr);
                        switchView('day');
                    });
                }
                
                monthCalendar.appendChild(cell);
            }
        }

        // 渲染日记事视图
        function renderDayRecordsView() {
            const dayRecordsContainer = document.getElementById('day-records-container');
            dayRecordsContainer.innerHTML = '';
            
            const dateStr = formatDate(currentDate, 'YYYY年MM月DD日');
            const weekday = ['日', '一', '二', '三', '四', '五', '六'][currentDate.getDay()];
            document.getElementById('day-title').textContent = `${dateStr} 星期${weekday}`;
            
            const dateKey = formatDate(currentDate, 'YYYY-MM-DD');
            const dayRecords = getRecordsByDate(dateKey);
            
            if (dayRecords.length > 0) {
                dayRecords.forEach(record => {
                    if (selectedObject && record.object !== selectedObject) return;
                    
                    const recordItem = document.createElement('div');
                    recordItem.className = `record-list-item ${record.completed ? 'checked' : ''}`;
                    recordItem.innerHTML = `
                        <input type="checkbox" ${record.completed ? 'checked' : ''} data-id="${record.id}">
                        <div class="record-date">${formatDate(new Date(record.date), 'MM月DD日')}</div>
                        <div class="record-object" data-object="${record.object}">${record.object}</div>
                        <div class="record-content">${record.content}</div>
                        <button class="delete-record" data-id="${record.id}">×</button>
                    `;
                    dayRecordsContainer.appendChild(recordItem);
                });
            } else {
                dayRecordsContainer.innerHTML = `
                    <div class="empty-state">
                        <i>📝</i>
                        <div>今天还没有记事</div>
                        <p>点击"添加记事"按钮创建新的记事</p>
                    </div>
                `;
            }
            
            document.querySelectorAll('.record-list-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const recordId = this.getAttribute('data-id');
                    toggleRecordCompletion(recordId, this.checked);
                });
            });
            
            document.querySelectorAll('.record-object').forEach(tag => {
                tag.addEventListener('click', function() {
                    const object = this.getAttribute('data-object');
                    objectSelect.value = object;
                    selectedObject = object;
                    refreshCurrentView();
                });
            });
            
            document.querySelectorAll('.delete-record').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordId = this.getAttribute('data-id');
                    deleteRecord(recordId);
                });
            });
        }

        // 渲染月记事视图
        function renderMonthRecordsView() {
            const monthRecordsContainer = document.getElementById('month-records-container');
            monthRecordsContainer.innerHTML = '';
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            document.getElementById('month-records-title').textContent = `${year}年${month}月记事`;
            
            const monthRecords = getRecordsByMonth(year, month);
            
            if (monthRecords.length > 0) {
                const groupedRecords = groupRecordsByObject(monthRecords);
                
                Object.keys(groupedRecords).forEach(object => {
                    if (selectedObject && object !== selectedObject) return;
                    
                    const objectSection = document.createElement('div');
                    objectSection.className = 'object-section';
                    objectSection.innerHTML = `<h3>${object}</h3>`;
                    
                    const recordsList = document.createElement('div');
                    
                    groupedRecords[object].forEach(record => {
                        const recordItem = document.createElement('div');
                        recordItem.className = `record-list-item ${record.completed ? 'checked' : ''}`;
                        
                        const recordDate = new Date(record.date);
                        const day = recordDate.getDate().toString().padStart(2, '0');
                        const contentWithNumber = `${day}${record.content}`;
                        
                        recordItem.innerHTML = `
                            <input type="checkbox" ${record.completed ? 'checked' : ''} data-id="${record.id}">
                            <div class="record-date">${formatDate(recordDate, 'MM月DD日')}</div>
                            <div class="record-content">${contentWithNumber}</div>
                            <button class="delete-record" data-id="${record.id}">×</button>
                        `;
                        recordsList.appendChild(recordItem);
                    });
                    
                    objectSection.appendChild(recordsList);
                    monthRecordsContainer.appendChild(objectSection);
                });
            } else {
                monthRecordsContainer.innerHTML = `
                    <div class="empty-state">
                        <i>📅</i>
                        <div>本月还没有记事</div>
                        <p>点击"添加记事"按钮创建新的记事</p>
                    </div>
                `;
            }
            
            document.querySelectorAll('.record-list-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const recordId = this.getAttribute('data-id');
                    toggleRecordCompletion(recordId, this.checked);
                });
            });
            
            document.querySelectorAll('.delete-record').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordId = this.getAttribute('data-id');
                    deleteRecord(recordId);
                });
            });
        }

        // 渲染年记事视图
        function renderYearRecordsView() {
            const yearRecordsContainer = document.getElementById('year-records-container');
            yearRecordsContainer.innerHTML = '';
            
            const year = currentDate.getFullYear();
            document.getElementById('year-title').textContent = `${year}年记事`;
            
            const yearRecords = getRecordsByYear(year);
            
            if (yearRecords.length > 0) {
                const groupedRecords = groupRecordsByObject(yearRecords);
                
                Object.keys(groupedRecords).forEach(object => {
                    if (selectedObject && object !== selectedObject) return;
                    
                    const objectSection = document.createElement('div');
                    objectSection.className = 'object-section';
                    objectSection.innerHTML = `<h3>${object}</h3>`;
                    
                    const recordsList = document.createElement('div');
                    
                    groupedRecords[object].forEach(record => {
                        const recordItem = document.createElement('div');
                        recordItem.className = `record-list-item ${record.completed ? 'checked' : ''}`;
                        
                        const recordDate = new Date(record.date);
                        const month = (recordDate.getMonth() + 1).toString().padStart(2, '0');
                        const day = recordDate.getDate().toString().padStart(2, '0');
                        const contentWithNumber = `${month}月${day}日 ${record.content}`;
                        
                        recordItem.innerHTML = `
                            <input type="checkbox" ${record.completed ? 'checked' : ''} data-id="${record.id}">
                            <div class="record-date">${formatDate(recordDate, 'MM月DD日')}</div>
                            <div class="record-content">${contentWithNumber}</div>
                            <button class="delete-record" data-id="${record.id}">×</button>
                        `;
                        recordsList.appendChild(recordItem);
                    });
                    
                    objectSection.appendChild(recordsList);
                    yearRecordsContainer.appendChild(objectSection);
                });
            } else {
                yearRecordsContainer.innerHTML = `
                    <div class="empty-state">
                        <i>📊</i>
                        <div>今年还没有记事</div>
                        <p>点击"添加记事"按钮创建新的记事</p>
                    </div>
                `;
            }
            
            document.querySelectorAll('.record-list-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const recordId = this.getAttribute('data-id');
                    toggleRecordCompletion(recordId, this.checked);
                });
            });
            
            document.querySelectorAll('.delete-record').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordId = this.getAttribute('data-id');
                    deleteRecord(recordId);
                });
            });
        }

        // 显示添加记事模态框
        function showAddRecordModal() {
            let defaultDate;
            if (currentView === 'day') {
                defaultDate = formatDate(currentDate, 'YYYY-MM-DD');
            } else {
                defaultDate = formatDate(new Date(), 'YYYY-MM-DD');
            }
            
            document.getElementById('record-date').value = defaultDate;
            document.getElementById('record-object').value = selectedObject || '';
            document.getElementById('record-content').value = '';
            
            addRecordModal.style.display = 'flex';
        }

        // 保存记录
        async function saveRecord() {
            const date = document.getElementById('record-date').value;
            const object = document.getElementById('record-object').value;
            const content = document.getElementById('record-content').value;
            
            const newRecord = {
                id: Date.now().toString(),
                date: date,
                object: object,
                content: content,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            records.push(newRecord);
            await saveRecordToFirebase(newRecord);
            
            addRecordModal.style.display = 'none';
            addRecordForm.reset();
            refreshCurrentView();
            
            alert('记事已保存！');
            showSyncStatus('数据已同步');
        }

        // 删除记录
        async function deleteRecord(recordId) {
            if (confirm('确定要删除这条记事吗？')) {
                records = records.filter(record => record.id !== recordId);
                await deleteRecordFromFirebase(recordId);
                refreshCurrentView();
                showSyncStatus('数据已同步');
            }
        }

        // 切换记录完成状态
        async function toggleRecordCompletion(recordId, completed) {
            const recordIndex = records.findIndex(r => r.id === recordId);
            if (recordIndex !== -1) {
                records[recordIndex].completed = completed;
                await saveRecordToFirebase(records[recordIndex]);
                refreshCurrentView();
                showSyncStatus('数据已同步');
            }
        }

        // 工具函数：获取一周的日期
        function getWeekDates(date) {
            const day = date.getDay();
            const startDate = new Date(date);
            startDate.setDate(date.getDate() - day);
            
            const weekDates = [];
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                weekDates.push(currentDate);
            }
            
            return weekDates;
        }

        // 工具函数：获取周数
        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        // 工具函数：格式化日期
        function formatDate(date, format) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            
            if (format === 'YYYY-MM-DD') {
                return `${year}-${month}-${day}`;
            } else if (format === 'YYYY年MM月DD日') {
                return `${year}年${month}月${day}日`;
            } else if (format === 'MM月DD日') {
                return `${month}月${day}日`;
            }
            
            return `${year}-${month}-${day}`;
        }

        // 工具函数：根据日期获取记录
        function getRecordsByDate(date) {
            return records.filter(record => record.date === date);
        }

        // 工具函数：根据年月获取记录
        function getRecordsByMonth(year, month) {
            const monthStr = month.toString().padStart(2, '0');
            return records.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate.getFullYear() === year && 
                       (recordDate.getMonth() + 1) === month;
            });
        }

        // 工具函数：根据年获取记录
        function getRecordsByYear(year) {
            return records.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate.getFullYear() === year;
            });
        }

        // 工具函数：按对象分组记录
        function groupRecordsByObject(records) {
            return records.reduce((groups, record) => {
                if (!groups[record.object]) {
                    groups[record.object] = [];
                }
                groups[record.object].push(record);
                return groups;
            }, {});
        }

        // 周视图导航
        function changeWeek(offset) {
            currentDate.setDate(currentDate.getDate() + offset * 7);
            renderWeekView();
        }

        // 月视图导航
        function changeMonth(offset) {
            currentDate.setMonth(currentDate.getMonth() + offset);
            renderMonthView();
        }

        // 日记事导航
        function changeDay(offset) {
            currentDate.setDate(currentDate.getDate() + offset);
            renderDayRecordsView();
        }

        // 月记事导航
        function changeMonthRecord(offset) {
            currentDate.setMonth(currentDate.getMonth() + offset);
            renderMonthRecordsView();
        }

        // 年记事导航
        function changeYear(offset) {
            currentDate.setFullYear(currentDate.getFullYear() + offset);
            renderYearRecordsView();
        }
    </script>
</body>
</html>